<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11 Internal Tables Grouping - ABAP Cheat Sheet</title>
    <style>

        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-top: 20px;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 30px;
        }
        h3 {
            color: #34495e;
            margin-top: 25px;
        }
        h4, h5, h6 {
            color: #34495e;
            margin-top: 20px;
        }
        p {
            margin: 10px 0;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', Consolas, Monaco, monospace;
            color: #c7254e;
            font-size: 0.9em;
        }
        pre {
            background-color: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            font-size: 0.9em;
            line-height: 1.5;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        li {
            margin: 5px 0;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
            color: #2980b9;
        }
        hr {
            border: none;
            border-top: 2px solid #bdc3c7;
            margin: 30px 0;
        }
        .note {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
        }
        blockquote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 15px 0;
            color: #555;
            font-style: italic;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            table {
                font-size: 0.9em;
            }
            th, td {
                padding: 8px;
            }
        }
    
    </style>
</head>
<body>
<p>&lt;a name=&quot;top&quot;&gt;&lt;/a&gt;</p>
<h1>Internal Tables: Grouping</h1>
<ul>
<li><a href="#internal-tables-grouping">Internal Tables: Grouping</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#grouping-by-one-column">Grouping by One Column</a></li>
<li><a href="#grouping-by-more-than-one-column">Grouping by More than One Column</a></li>
<li><a href="#group-key-binding-when-grouping-by-one-column">Group Key Binding when Grouping by One Column</a></li>
<li><a href="#group-key-binding-when-grouping-by-more-than-one-column">Group Key Binding when Grouping by More than One Column</a></li>
<li><a href="#executable-example">Executable Example</a></li>
</ul>
<h2>Introduction</h2>
<p>Similar to SQL&#x27;s <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abapgroupby_clause.htm"><code>GROUP BY</code></a>, there is also a <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by.htm"><code>GROUP BY</code></a> for working with internal tables that can be used behind <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_variants.htm"><code>LOOP AT itab</code></a> or in the form <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenfor_in_group.htm"><code>IN GROUP</code></a> in a table iteration with <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenfor_itab.htm"><code>FOR</code></a>. It replaces the clumsy group level processing with statements <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abapat_itab.htm"><code>AT NEW ...</code></a> that relies on the order of table columns and content that is sorted respectively.</p>
<p>Thi cheat sheet explains the grouping of internal tables step by step using a very simple case of an internal table <code>spfli_tab</code> that is filled with data from the database table <code>SPFLI</code>. The following steps show how the content of the internal table can be grouped using <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by.htm"><code>LOOP AT GROUP BY</code></a>.</p>
<h2>Grouping by One Column</h2>
<p>The simplest form of grouping is by one column without explicitly specifying the output behavior of the group loop:</p>
<pre><code>LOOP AT spfli_tab INTO wa
                  GROUP BY wa-carrid.
       ... wa-carrid ...
ENDLOOP.</code></pre>
<p>Within the loop, there is access to the work area <code>wa</code>, in particular to the component <code>wa-carrid</code> that is used for grouping. The work area <code>wa</code> contains the first line of each group and represents the group in the loop. This is called representative binding.</p>
<pre><code>LOOP AT spfli_tab INTO wa 
                  GROUP BY wa-carrid.
  ...
  LOOP AT GROUP wa INTO DATA(member).
    ... member-... ...
  ENDLOOP.
  ...
ENDLOOP.</code></pre>
<p>To access the members of a group, a member loop can be inserted into the group loop:</p>
<p>The member loop is executed using the group represented by <code>wa</code> and its members are assigned to <code>member</code> and are available in the member loop.</p>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h2>Grouping by More than One Column</h2>
<p>To group by more than just one criterion, a structured group key is defined as follows. In the simplest case, the grouping criteria are columns of the internal table:</p>
<pre><code>LOOP AT spfli_tab INTO wa 
                  GROUP BY ( key1 = wa-carrid key2 = wa-airpfrom ).
  ... wa-carrid ... wa-airpfrom ...
ENDLOOP.</code></pre>
<p>This is also a representative binding in which the work area <code>wa</code> is reused in the group loop to access the group key.</p>
<p>To access the members of the groups, the exact same member loop can be inserted as when grouping by one column.</p>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h2>Group Key Binding when Grouping by One Column</h2>
<p>By explicitly specifying an <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by_binding.htm">output area</a> for the group key, a group key binding can be defined explicitly instead of the representative binding in which the output area of the group loop is reused:</p>
<pre><code>LOOP AT spfli_tab INTO wa 
                  GROUP BY wa-carrid 
                  INTO DATA(key).
  ... key ...
ENDLOOP.</code></pre>
<p>The difference to the example with representative binding is the <code>INTO</code> addition after <code>GROUP BY</code>. Instead of reusing <code>wa</code>, an elementary data object <code>key</code> represents the group. This can be generated inline. The additions <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by_key.htm"><code>GROUP SIZE</code></a>, <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by_key.htm"><code>GROUP INDEX</code></a>, and <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by.htm"><code>WITHOUT MEMBERS</code></a> can only be used in the group key binding, which gives it more functions than the representative binding. If these are not required, the representative binding can be used. The group key binding can also be used to make the use of the group key in the loop more explicit.</p>
<p>Inserting a member loop works in the same way as in the representative binding, with the difference that a group is now addressed by <code>key</code> instead of <code>wa</code>.</p>
<pre><code>LOOP AT spfli_tab INTO wa 
                  GROUP BY wa-carrid 
                  INTO key.
  ...
  LOOP AT GROUP key INTO member.
    ... members ...
  ENDLOOP.
  ...
ENDLOOP.</code></pre>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h2>Group Key Binding when Grouping by More than One Column</h2>
<p>Finally, the group key binding for structured group keys:</p>
<pre><code>LOOP AT spfli_tab INTO wa
                  GROUP BY ( key1 = wa-carrid key2 = wa-airpfrom )
                  INTO DATA(key).
  ... key-key1 ... key-key2 ...
ENDLOOP.</code></pre>
<p>Here, <code>key</code> is a structure with the components <code>key1</code> and <code>key2</code>. A member loop can be inserted in exactly the same way as when grouping by one column.</p>
<p>If the group members are not relevant, the addition <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by.htm"><code>WITHOUT MEMBERS</code></a> can be used to save time and memory.</p>
<pre><code>LOOP AT spfli_tab INTO wa
                  GROUP BY ( key1 = wa-carrid key2 = wa-airpfrom
                             index = GROUP INDEX size = GROUP SIZE )
                  WITHOUT MEMBERS
                  INTO DATA(key).
  ... key-key1 ... key-key2 ... key-index ... key-size ...
ENDLOOP.</code></pre>
<p>It is no longer possible to use a member loop here. Instead, the group key was enriched with optional components for further information using <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by_key.htm"><code>GROUP INDEX</code></a> <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abaploop_at_itab_group_by_key.htm"><code>GROUP SIZE</code></a>.</p>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h2>Executable Example</h2>
<p><a href="./src/zcl_demo_abap_sql_group_by.clas.abap">zcl_demo_abap_sql_group_by</a></p>
<div class="note">[!NOTE] - The steps to import and run the code are outlined [here](README.md#-getting-started-with-the-examples). - [Disclaimer](./README.md#%EF%B8%8F-disclaimer)</div>
</body>
</html>