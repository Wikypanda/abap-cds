<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>36 RAP Behavior Definition Language - ABAP Cheat Sheet</title>
    <style>

        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-top: 20px;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 30px;
        }
        h3 {
            color: #34495e;
            margin-top: 25px;
        }
        h4, h5, h6 {
            color: #34495e;
            margin-top: 20px;
        }
        p {
            margin: 10px 0;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', Consolas, Monaco, monospace;
            color: #c7254e;
            font-size: 0.9em;
        }
        pre {
            background-color: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            font-size: 0.9em;
            line-height: 1.5;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        li {
            margin: 5px 0;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
            color: #2980b9;
        }
        hr {
            border: none;
            border-top: 2px solid #bdc3c7;
            margin: 30px 0;
        }
        .note {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
        }
        blockquote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 15px 0;
            color: #555;
            font-style: italic;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            table {
                font-size: 0.9em;
            }
            th, td {
                padding: 8px;
            }
        }
    
    </style>
</head>
<body>
<p>&lt;a name=&quot;top&quot;&gt;&lt;/a&gt;</p>
<h1>RAP Behavior Definition Language</h1>
<ul>
<li><a href="#rap-behavior-definition-language">RAP Behavior Definition Language</a></li>
<li><a href="#rap-bo-related-repository-objects-in-a-nutshell">RAP-BO-Related Repository Objects in a Nutshell</a></li>
<li><a href="#rap-bdl-syntax">RAP BDL Syntax</a></li>
<li><a href="#behavior-definition-header">Behavior Definition Header</a></li>
<li><a href="#entity-behavior-definitions">Entity Behavior Definitions</a></li>
<li><a href="#entity-behavior-characteristics">Entity Behavior Characteristics</a></li>
<li><a href="#entity-behavior-body">Entity Behavior Body</a></li>
<li><a href="#more-information">More Information</a></li>
</ul>
<p>This ABAP cheat sheet highlights key features and syntax options of the <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenbdl_glosry.htm">RAP Behavior Definition Language (BDL)</a> for designing <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_behavior_definition_glosry.htm">RAP behavior definitions (BDEF)</a>.</p>
<div class="note">[!NOTE] - A wide range of specification options is available. The ABAP cheat sheet illustrates a selection. It does not provide a comprehensive overview. - To get the complete picture, refer to the [ABAP Keyword Documentation](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL.html) and the [Development guide for the ABAP RESTful Application Programming Model](https://help.sap.com/docs/abap-cloud/abap-rap/abap-restful-application-programming-model).</div>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h2>RAP-BO-Related Repository Objects in a Nutshell</h2>
<p>This section highlights typical repository objects for a typical RAP BO setup, and how the BDEF fits in.</p>
<div class="note">[!NOTE] What is a RAP BO? - A RAP BO represents a real-world business entity with specific data, characteristics, and functionality (its behavior). - Typically, a RAP BO involves: - A standardized approach to modeling business data as CDS entities with relationships, forming a tree-like hierarchy of nodes. A RAP BO is based on a root entity (a special kind of CDS entity that serves as the top-level entity) and child entities usually linked in compositions, which are special kinds of associations. In simple cases, a RAP BO may involve just a root entity, while more complex scenarios include one or multiple child entities. - Defining transactional behavior, which includes the functionality needed to work with the data. This can encompass standard operations like create, read, update, and delete (CRUD), as well as other nonstandard operations specific to the RAP BO. - Implementing the transactional behavior. - Exposing data and behavior as a service, allowing RAP BO consumers (such as UIs) to consume these services.</div>
<p>Typical RAP BO setups follow a layered approach, illustrated by the following table:</p>
<p>&lt;table&gt;</p>
<p>&lt;tr&gt; &lt;th&gt; Layer &lt;/th&gt; &lt;th&gt; Repository Objects &lt;/th&gt; &lt;th&gt; Notes &lt;/th&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td rowspan=&quot;2&quot;&gt;</p>
<p>Data modeling</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<p>Database tables (or CDS table entities)</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<p>Used for data persistence and as the basis of CDS entities.</p>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Core Data Services (CDS)</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Core Data Services (CDS) are used to model RAP BO entities, with each RAP BO entity represented by its own CDS entity.</li>
<li>A tree-like hierarchy of entities is typically based on one CDS root entity, the top CDS entity which represents a CDS parent for further child entities. The CDS root entities are specified with a special syntax: <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_define_root_view_v2.htm"><code>define root view entity</code></a>.</li>
<li>CDS entities are linked by defining relationships through associations or compositions. A composition relationship indicates a close dependency between entities, meaning a child entity relies on its parent entity. For example, using sales orders as example context. A sales order item (assumingly a child entity within a sales order BO) cannot exist without the corresponding sales order. If the sales order is deleted, the associated sales order item has to be deleted as well, along with any other related sales order items. This contrasts with association relationships, where parent and child entity data can exist independently.</li>
<li>Find more information in the <a href="https://help.sap.com/docs/abap-cloud/abap-data-models/abap-data-models">ABAP Data Models guide</a>.</li>
</ul>
<div class="note">[!NOTE] - A related repository object is [CDS access control](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_access_control_glosry.htm). Here, you can define access rules for the involved CDS entities. In a RAP BO setup, CDS access control typically manages read access, while modification authorization (using authorization objects) is handled in behavior implementations. - [CDS annotations](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_annotation_glosry.htm) represent metadata that can be added, for example, to control UI rendering and layout. You can add these annotations to the CDS entity's source code directly or outsource them to [CDS metadata extensions](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_metadata_extension_glosry.htm), a further repository object. Find more information on CDS annotations [here](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENCDS_ANNOTATIONS.html).</div>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td rowspan=&quot;2&quot;&gt;</p>
<p>RAP BO behavior</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<p>RAP behavior definition (BDEF)</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Defines the behavior of a RAP BO and all its entities.</li>
<li>Behavior includes operations (such as create, update, delete, and others) and characteristics (which fields are read-only or mandatory, and so on).</li>
<li>Typically, the BDEF shares the same name as the root view entity to which it refers.</li>
<li>BDEFs use <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenbdl_glosry.htm">RAP Behavior Definition Language (BDL)</a> for the definitions.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>ABAP behavior pool (ABP)</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Special <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenclass_pool_glosry.htm">class pool</a>, typically prefixed with <code>*BP</code>, that implements the behavior and contains the actual business logic.</li>
<li>The actual implementation occurs in the <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenccimp_glosry.htm">CCIMP include</a> (<em>Local Types</em> tab in ADT).</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Projections</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<p>CDS projection view, RAP projection BDEF, ABAP behavior pool</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Projections introduce an optional layer (a <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_projection_bo_glosry.htm">RAP projection business object</a>) that enables you to adapt the RAP BO&#x27;s data model and functionality to tailor specific services for different <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_bo_consumer_glosry.htm">RAP BO consumers</a>, such as UIs or APIs. For example, target group A may access a UI with the full functionality, while target group B may use a UI with certain disabled functionalities, such as delete operations.</li>
<li>Projections involve creating artifacts like:</li>
<li><a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_projection_view_glosry.htm">CDS projection view</a>: Represents a special CDS view entity that is based on another CDS view entity. CDS projection views adapt a CDS data model for service-specific use cases. For a projection BO, the root entity must be a CDS projection view.</li>
<li><a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_proj_bdef_glosry.htm">RAP projection behavior definition</a>: Created for the CDS projection view. Indicates that a base BDEF is projected. A projection BDEF builds on the base BDEF, reusing its operations and characteristics or limiting them to enable only a subset. Typical syntax elements are <code>use ...</code>, for example, <code>use create;</code>, <code>use update;</code>, <code>use action act;</code>, and so on.</li>
<li>A separate <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenbehavior_pool_glosry.htm">ABAP behavior pool</a> for the RAP projection BDEF, if required.</li>
<li>Find more information <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_PROJECTION_BO.html">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td rowspan=&quot;2&quot;&gt;</p>
<p>Business service</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<p>Service definition</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<p>Exposes RAP BO entities along with their data and behavior as a business service for consumers.</p>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Service binding</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<p>Binds a service definition to a communication protocol and publishes it as a business service of <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenas_abap_glosry.htm">AS ABAP</a> (for example, a UI or <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenodata_glosry.htm">OData</a> serivce).</p>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;/table&gt;</p>
<div class="note">[!TIP] To create an OData UI service and all RAP service-related repository objects from scratch, you can use a wizard in ADT. Find more information [here](https://help.sap.com/docs/abap-cloud/abap-rap/odata-ui-service-from-scratch).</div>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h2>RAP BDL Syntax</h2>
<p>The following sections illustrate the structure of BDEFs and syntax options.</p>
<p>Demo BDEF that highlights the structure:</p>
<pre><code>// -------------- Behavior Definition Header --------------
managed implementation in class ZBP_R_DEMO_ABAP unique;
strict ( 2 );
with draft;

// -------------- Entity Behavior Definitions --------------
define behavior for ZR_DEMO_ABAP alias demo_abap
// -------------- Entity Behavior Characteristics --------------
persistent table zdemoabap
draft table zdemoabap_d
etag master LocalLastChangedAt
lock master total etag LastChangedAt
authorization master ( none )
late numbering
// -------------- Entity Behavior Body --------------
{
  field ( readonly ) ID, CalcResult, LocalCreatedBy, LocalCreatedAt, LocalLastChangedBy,
                     LocalLastChangedAt, LastChangedAt;

  field ( mandatory ) Number1, Number2, Operator;

  create;
  update;
  delete;

  validation validate on save { create; field Number1, Number2, Operator; }
  determination det_modify on modify { field Number1, Number2, Operator; }
  internal action calculation;

  draft action Resume;
  draft action Edit;
  draft action Activate optimized;
  draft action Discard;
  draft determine action Prepare
  {
    validation validate;
  }
  
  mapping for zdemoabap corresponding
    {
      ID                 = ID;
      Number1            = Number1;
      Number2            = Number2;
      Operator           = Operator;
      CalcResult         = calc_result;
      LocalCreatedBy     = LOCAL_CREATED_BY;
      LocalCreatedAt     = LOCAL_CREATED_AT;
      LocalLastChangedBy = LOCAL_LAST_CHANGED_BY;
      LocalLastChangedAt = LOCAL_LAST_CHANGED_AT;
      LastChangedAt      = LAST_CHANGED_AT;
    }
}</code></pre>
<div class="note">[!NOTE] - The syntax covered is not comprehensive and only provides a high-level overview. For example, it does not cover options related to interface, projection, abstract behavior definitions, or syntax related to BDEF extensions. - For the complete picture, refer to the subtopics in the [ABAP Keyword Documentation](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL.html).</div>
<h3>Behavior Definition Header</h3>
<p>&lt;table&gt;</p>
<p>&lt;tr&gt; &lt;th&gt; Subject &lt;/th&gt; &lt;th&gt; Code Snippet &lt;/th&gt; &lt;th&gt; Notes &lt;/th&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Managed implementation type</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>managed implementation  
  in class zbp_demo_abap_rap_entity unique;</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li><em>Managed</em> and <em>unmanaged</em> refer to two implementation types of RAP BOs. The key distinction lies in how the BO&#x27;s transactional behavior and <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abentransactional_buffer_glosry.htm">transactional buffer</a> are provisioned.</li>
<li>The managed implementation is typically used for greenfield scenarios, where app development starts from scratch without any existing business logic.</li>
<li>In a managed RAP BO, standard operations (CRUD) function out of the box, allowing applications to use them without custom development. This includes both the provisioning and handling of the transactional buffer, as well as save handling (except for the saving options for managed RAP BOs noted below).</li>
<li>Essentially, you only need to specify <code>create</code>, <code>update</code>, and <code>delete</code> in the BDEF, and the managed RAP BO will automatically support transactional processing (syntax for enabling read operations is not available; read operations work out of the box as well). Additional business logic, such as authorization, actions, validations, and determinations, and more, can be implemented in the ABAP behavior pool.</li>
<li>By using <code>implementation in class ... unique</code>, you can specify one or more implementation classes. Note that this specification is optional for managed RAP BOs since CRUD operations are implicitly supported. It is only necessary if your BO needs further transactional handling. The specification of <code>unique</code> is mandatory and indicates that each operation can be implemented only once.</li>
<li>Find more information <a href="https://help.sap.com/docs/abap-cloud/abap-rap/business-object-implementation-types">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Unmanaged implementation type</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>unmanaged implementation 
  in class zbp_demo_abap_rap_entity_u unique;</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>The unmanaged implementation type is typically used for brownfield scenarios where existing application logic needs to be embedded in the RAP world to leverage standardized RAP runtime orchestration.</li>
<li>The unmanaged RAP BO provider must supply everything, meaning developers must provide the transactional buffer and implement all RAP BO operations.</li>
<li>Find more information <a href="https://help.sap.com/docs/abap-cloud/abap-rap/business-object-implementation-types">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Saving options in managed RAP BOs</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>managed with additional save ...

managed with unmanaged save ...</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>In managed RAP BOs, saving is automatically handled by default, eliminating the need for custom implementations. However, you can enhance or replace the default save sequence in managed RAP BOs.</li>
<li>Regardless of the approach, the save handling applies to the entire RAP BO.</li>
<li>The ABAP behavior pool requires the implementation of a local saver class, including the implementation of the saving mechanism in the <code>save_modified</code> method.</li>
<li>You enhance the save sequence with <code>with additional save</code> for tasks like changing documents, raising business events, or logging applications.</li>
<li>You replace the automatic saving process with your custom logic by using <code>with unmanaged save</code>. Note that you cannot specify the <code>persistent table</code> in this case.</li>
<li>Additional syntax options (which can be combined) for both enhancements include:</li>
<li><code>and cleanup ...</code>: This option requires the redefinition of the <code>cleanup</code> method in the saver class.</li>
<li><code>with full data ...</code>: If specified, the full instance data is passed to the <code>save_modified</code> method in the saver class, which can help avoid extra read operations. By default, only the key values of RAP BO instances are passed.</li>
<li>Note that you can specify <code>with additional save</code> and <code>with unmanaged save</code> not only in the BDEF header but also for each entity individually after <code>define behavior</code> (e.g., <code>define behavior for some_entity with unmanaged save</code>).</li>
<li>Find more information <a href="https://help.sap.com/docs/abap-cloud/abap-rap/save-options">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Strict mode</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>strict(2);</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>With strict mode enabled, additional syntax checks for RAP behavior definitions are activated.</li>
<li>Since the RAP framework provides the checks, no additional implementation is needed in the ABAP behavior pool.</li>
<li>It is recommended to use the most recent version, which is currently 2.</li>
<li>Find more information <a href="https://help.sap.com/docs/abap-cloud/abap-rap/strict-mode">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Draft handling</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>with draft; </code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Enables draft handling for the entire RAP BO, allowing users to save changes as drafts and resume editing later.</li>
<li>Note that the transactional engine orchestrates draft handling, so developers do not need to manage how draft data is written to the draft database table.</li>
<li>The <code>with collaborative draft;</code> notation also enables draft handling and allows multiple users to work on the same draft instance simultaneously.</li>
<li>Find more information <a href="https://help.sap.com/docs/abap-cloud/abap-rap/draft">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;!-- --&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>ABP auxiliary classes</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>auxiliary class zcl_some_class;</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>ABP auxiliary classes provide reusable methods for implementing behaviors, allowing you to outsource functionality and simplify concurrent work. They offer enhanced access rights to the referenced RAP BO, meaning you can use the <code>IN LOCAL MODE</code> addition with ABAP EML statements.</li>
<li>You can specify one or more global ABP auxiliary classes. Multiple classes can be specified in a comma-separated list.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;/table&gt;</p>
<div class="note">[!NOTE] More syntax options are available in the BDEF header, including enabling BDEF extensions, privileged mode, defining authorization contexts, cross-BO transactional handling, and more. Find more information [here](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_BDEF_HEADER.html).</div>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h3>Entity Behavior Definitions</h3>
<p>&lt;table&gt;</p>
<p>&lt;tr&gt; &lt;th&gt; Subject &lt;/th&gt; &lt;th&gt; Code Snippet &lt;/th&gt; &lt;th&gt; Notes &lt;/th&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Entity behavior definition</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>define behavior for some_entity alias root</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>A BDEF can include one or more entity behavior definitions that begin with <code>define behavior for</code>. Each definition corresponds to a different entity of the business object.</li>
<li>You must specify an entity behavior definition for the root entity. Defining behaviors for child entities is optional.</li>
<li>Syntax options:</li>
<li><code>alias some_name</code>: This optional alias allows for a clearer, more descriptive name. The alias is visible in the handler methods of the ABP and the <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_derived_type_glosry.htm">BDEF derived types</a>.</li>
<li><code>external some_external_name</code>: This option specifies an alias for external use, which is exposed in the OData metadata.</li>
<li><code>implementation in class ... unique</code>: Instead of specifying the ABAP behavior pool in the BDEF header, you can also specify it here for implementing the behavior of the referenced RAP BO entity. The previously mentioned additions for additional and unmanaged save are also applicable here.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;/table&gt;</p>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h4>Entity Behavior Characteristics</h4>
<p>Following the <code>define behavior for</code> specification, additional properties for a RAP BO entity can (or must) be specified.</p>
<p>&lt;table&gt;</p>
<p>&lt;tr&gt; &lt;th&gt; Subject &lt;/th&gt; &lt;th&gt; Code Snippet &lt;/th&gt; &lt;th&gt; Notes &lt;/th&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Table specifications</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>persistent table some_table

draft table some_draft_table</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li><code>persistent table</code></li>
<li>Specifies the <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenddic_db_table_glosry.htm">DDIC database table</a> (or <a href="https://help.sap.com/docs/abap-cloud/abap-rap/using-table-entities-as-active-persistence">CDS table entity</a>) for storing RAP BO data.</li>
<li>Can only be specified for managed RAP BOs.</li>
<li>Note that the transactional buffer serves as temporary storage for RAP BO instance data processed during a RAP transaction. For reads and modifications of persisted data, the data is loaded into the transactional buffer. At the end of a RAP transaction, changes in the buffer are either committed to the persistent table or rolled back.</li>
<li><code>draft table</code></li>
<li>Specifies the database table for storing draft data in draft-enabled RAP BOs. Draft-enabled RAP BOs require two separate database tables: one for persistent data and another for draft instances.</li>
<li>This table must reflect the fields from the underlying CDS entity. Alias field names must be used, if any. The types must be compatible, and a client field must be present. In cases of late numbering, an additional key field (<code>DRAFTUUID</code>, 16-character byte-like type) is required.</li>
<li>Additionally, the draft table must include the draft admin entry <code>&quot;%admin&quot;: include sych_bdl_draft_admin_inc;</code>. It represents technical information needed by the RAP transactional engine for draft handling.</li>
<li>Note that the draft table should not be accessed directly using ABAP SQL for read or modify operations.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Concurrency control</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>//ETag for optimistic concurrency control
etag master some_etag_field
etag dependent by _Assoc
total etag some_total_etag_field

//Locking for pessimistic concurrency control
lock master
lock dependent by _Assoc</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Concurrency control manages concurrent access to the same data by different users. Two approaches to consider in RAP are:</li>
<li>Optimistic concurrency control: This approach allows multiple users to access data while avoiding inconsistencies caused by unintentional changes to already modified data. In RAP, the ETag field in the RAP behavior definition ensures this.</li>
<li>Pessimistic concurrency control: This approach involves <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenexclusive_lock_glosry.htm">exclusive locking</a> of data sets, preventing simultaneous modification by more than one user.</li>
<li>Entity tag (ETag, <code>etag ...</code>) for optimistic concurrency control:</li>
<li>The ETag field specification is optional for each entity of the RAP BO. The <code>dependent</code> specification indicates that the ETag field of another entity is used for optimistic concurrency control.</li>
<li>This field logs modifications of an instance, using a timestamp or another unique identification value. It is particularly relevant when consuming RAP BOs via OData. For a modify operation to be accepted, the OData client must send an ETag value with each modify operation, which is compared to the stored ETag value to allow modification only when the values match.</li>
<li>Managed RAP BOs automatically manage optimistic concurrency control when the CDS annotation <code>@Semantics.systemDateTime.localInstanceLastChangedAt: true</code> is available. The ETag field&#x27;s data type should be <code>utclong</code>, <code>timestamp</code>, or <code>timestampl</code>, and it is advisable to mark the field as read-only in the BDEF. In unmanaged RAP BOs, custom implementations for ETag field handling are required (for example, in the save sequence).</li>
<li><code>total etag</code> is relevant and mandatory only for draft-enabled BOs. The value of the total ETag is particularly used for draft instances that are edited, and which have a corresponding active instance. When a draft instance is created, the active instance is locked exclusively and cannot be modified by another user. The exclusive lock remains for a (configurable) timespan, even if the ABAP session terminates. Once the lock expires, the optimistic lock phase begins. During this phase, users can resume the draft instance as long as the active instance remains unchanged. The total ETag value of the draft instance is compared to that of the active instance for resumability, allowing continuation when the values match.</li>
<li>It is recommended to use different fields for <code>total etag</code> and <code>etag master</code>. The specification must occur only after <code>lock master</code>. To support total ETag handling automatically in managed RAP BOs, the same type prerequisites apply as mentioned above. The required CDS annotation is <code>@Semantics.systemDateTime.lastChangedAt: true</code>.</li>
<li>Locking for pessimistic concurrency control (<code>lock ...</code>):</li>
<li>The <code>lock master</code> specification must be applied to the root entity, and each child entity must be defined as a lock-dependent entity (<code>lock dependent by ...</code>).</li>
<li>In managed RAP BOs, the locking mechanism is automatically handled for update, delete, and create-by-association operations, as well as actions (with a <code>lock:none</code> specification available to prevent locking in that context). If you specify <code>lock master unmanaged</code>, the locking mechanism must be self-implemented in a dedicated RAP handler method.</li>
<li>Before changing data on the database, the corresponding data set receives a lock entry in the global lock table. When a request for a lock is made, this table is checked for an entry. If a lock already exists for the requested data set, the modify request is denied. Once the modification is committed (or rolled back, or the ABAP session is terminated), the lock entry is removed from the lock table.</li>
<li>Find more information here:</li>
<li><a href="https://help.sap.com/docs/abap-cloud/abap-rap/optimistic-concurrency-control">Optimistic Concurrency Control</a></li>
<li><a href="https://help.sap.com/docs/abap-cloud/abap-rap/pessimistic-concurrency-control-locking">Pessimistic Concurrency Control</a></li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Numbering</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>early numbering

late numbering</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>The concept of numbering in RAP is about assigning values to primary key fields.</li>
<li>There are multiple options for handling the numbering of primary key fields, depending on when (early in the <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_int_phase_glosry.htm">RAP interaction phase</a> or late in the <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_save_seq_glosry.htm">RAP save sequence</a>) and by whom (RAP BO consumer, ABAP behavior pool, or framework).</li>
<li>When:</li>
<li>Early numbering: Final key values are assigned during a RAP create operation in the interaction phase.</li>
<li>Late numbering: Final key values are assigned during the RAP save sequence, specifically in the <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenabp_saver_method_glosry.htm">RAP saver method</a> <code>adjust_numbers</code>.</li>
<li>By whom:</li>
<li>External numbering: Key values come from the RAP BO consumer. For example, during a create operation, the RAP BO consumer specifies the key values just like other non-key field values.</li>
<li>Internal numbering: Key values are provided by the RAP BO provider. For example, in a create operation, the RAP BO consumer does not specify the key values in an EML create request. Instead, the RAP BO provider provides the keys.</li>
<li>Variety of applicable numbering scenarios:</li>
<li>External early numbering:</li>
<li>Key values are provided by the RAP BO consumer, who must ensure that the keys are unique. Otherwise, the instance will be rejected during a save attempt.</li>
<li>Key fields should not be marked as read-only for create operations. It is advisable to define key fields with specific characteristics such as <code>... mandatory:create, readonly:update ...</code>.</li>
<li>Managed internal early numbering:</li>
<li>The framework automatically creates the key without any custom development needed in the ABP.</li>
<li>As a prerequisite, a <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenuuid_glosry.htm">UUID</a> scenario is in place, where the key is a 16-character byte-like type, which can hold UUID values.</li>
<li>Typically, the key has the field-specific characteristics <code>readonly</code> in the BDEF, along with <code>numbering:managed</code>.</li>
<li>Unmanaged internal early numbering:</li>
<li>In unmanaged RAP BOs, key values are provided in create operation implementations (that is, the <code>create</code> method). Note that <code>early numbering</code> is only applicable for unmanaged, draft-enabled RAP BOs.</li>
<li>In managed RAP BOs and unmanaged, draft-enabled RAP BOs, unmanaged early numbering must be implemented in the ABP&#x27;s handler method <code>FOR NUMBERING</code>.</li>
<li>The key typically has the field-specific characteristics <code>readonly</code> in the BDEF.</li>
<li>(Unmanaged internal) late numbering:</li>
<li>Late numbering is internal by default since no further interaction with the RAP BO consumer occurs in the late phase of the RAP save sequence.</li>
<li>It is available for both managed and unmanaged RAP BOs, but the numbering itself is unmanaged. It must be implemented in the <code>adjust_numbers</code> saver method.</li>
<li>By default, when no specifications are provided, the numbering is external.</li>
<li><code>early numbering</code>:</li>
<li>Used for early unmanaged numbering in managed RAP BOs, and is also possible for unmanaged, draft-enabled RAP BOs.</li>
<li>Typically, key fields are marked as read-only in the BDEF.</li>
<li>Requires implementation of key value assignment in the <code>FOR NUMBERING</code> handler method.</li>
<li><code>late numbering</code>:</li>
<li>Used to enable late numbering for managed and unmanaged RAP BOs.</li>
<li>Requires implementation of key value assignment in the RAP saver method <code>adjust_numbers</code>.</li>
</ul>
<div class="note">[!NOTE] - Find more information on numbering [here](https://help.sap.com/docs/abap-cloud/abap-rap/numbering). - Find more information regarding draft-enabled RAP BOs and numbering [here](https://help.sap.com/docs/abap-cloud/abap-rap/unmanaged-internal-late-numbering). - Ensuring uniqueness for key values is essential. In scenarios where the framework does not handle uniqueness checks, developers must implement these checks explicitly. For example, such checks can be included in the precheck.</div>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Authorization control</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>authorization master ( global ) 

authorization master ( instance ) 

authorization master ( global, instance ) 

authorization master ( none ) 

authorization dependent by _Assoc ...</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Authorization control in RAP restricts access to RAP BO data and/or protects it from unauthorized access.</li>
<li>Various types of authorization control exist in RAP:</li>
<li><code>global</code>: This refers to global authorization, which is independent of individual RAP BO instances. It checks user roles using authorization objects to determine if a user can create, update, delete, and so on.</li>
<li><code>instance</code>: This refers to instance authorization, which depends on the state of a RAP BO instance. Both <code>global</code> and <code>instance</code> can be specified simultaneously.</li>
<li><code>none</code>: This applies no authorization control.</li>
<li>Authorization control is especially important for modification operations such as create (only for global authorization), create-by-association, update, delete, and certain action types. Note that read operation authorization is generally governed by CDS access control.</li>
<li>At this stage, authorization control is declared using <code>authorization master</code>, defining the default for the entity. However, more specific options for authorization control can be set in the entity behavior body (for example, <code>authorization : update</code> or <code>authorization : none</code> for modification operations or actions). This allows for finer-grained authorization control. For example, while you might specify <code>authorization master ( global )</code> for the entity, you could also define an action in the entity behavior body with <code>authorization : none</code>, indicating that this action does not require an authorization check despite the global authorization default.</li>
<li>The root entity must specify an <code>authorization master</code>. Other RAP BO entities can either be <code>authorization master</code> or, for authorization-dependent entities, <code>authorization dependent by</code>.</li>
<li>Specifying global and/or instance authorization control with <code>authorization master</code> requires implementing dedicated RAP handler methods (<code>FOR GLOBAL AUTHORIZATION</code> and <code>FOR INSTANCE AUTHORIZATION</code>).</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;/table&gt;</p>
<div class="note">[!NOTE] Further syntax options are available such as for RAP change documents ([`changedocuments`](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_CHANGE_DOCUMENTS.html)).</div>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h4>Entity Behavior Body</h4>
<p>The entity behavior body holds definitions of the transactional behavior of RAP BO entities. The definitions are enclosed in curly brackets <code>{ ... }</code>.</p>
<p>&lt;table&gt;</p>
<p>&lt;tr&gt; &lt;th&gt; Subject &lt;/th&gt; &lt;th&gt; Code Snippet &lt;/th&gt; &lt;th&gt; Notes &lt;/th&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Field-specific characteristics</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>field ( readonly ) field_a, field_b, field_c; 
field ( readonly : create ) field_d;
field ( readonly : update ) field_e; 
field ( mandatory ) field_f; 
field ( mandatory : create ) field_g; 
field ( mandatory : update ) field_h;
field ( suppress ) field_i; 
field ( features : instance ) field_j; </code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>You can provide RAP BO fields with certain characteristics regarding access and provision.</li>
<li>It is possible to combine certain characteristics (with restrictions identified by syntax checks) within parentheses (for example, <code>field ( mandatory : create, readonly : update) field_k;</code>).</li>
<li>The field characteristics are static. Only the <code>features : instance</code> variant represents dynamic field characteristics.</li>
<li>Typically, key fields are specified with <code>readonly</code> or <code>readonly : update</code>.</li>
<li>Notes on the specifications:</li>
<li><code>readonly</code>: Values for the fields must not be created or updated by the RAP BO consumer (for example, key field values are provided solely by the RAP BO provider in internally managed numbering scenarios). By using <code>readonly : create</code> or <code>... update</code>, you explicitly specify a field as readonly during create or update operations.</li>
<li><code>mandatory</code>: Values for the fields must be provided before persisting the instance. By using <code>mandatory : create</code> or <code>... update</code>, you explicitly specify a field as mandatory for create or update operations. In external numbering scenarios, a typical specification combination for key fields is <code>mandatory : create</code> and <code>readonly : update</code>.</li>
<li><code>suppress</code>: Used to remove a field from BDEF derived types and all RAP APIs.</li>
<li><code>features : instance</code>: Defines access restrictions for fields based on the RAP BO instance state. When specified, the restrictions must be implemented in the <code>FOR INSTANCE FEATURES</code> handler method. For example, you might want to ensure that a field is mandatory or readonly when a RAP BO instance has a specific state (for example, when a field has a certain value).</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Managed internal numbering</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>field ( numbering : managed ) key_field;</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Defines managed internal numbering for a RAP BO key field.</li>
<li>This specification applies only to managed RAP BOs.</li>
<li>When creating instances, the framework automatically assigns unique values to the specified fields. These fields must be the primary key in the underlying CDS data model and have a 16-character byte-like type to hold UUID values.</li>
<li>Typically, the key fields are specified as <code>readonly</code> to prevent RAP BO consumers from passing key values, enabling a full internal numbering scenario. However, there are cases where you may choose not to use the <code>readonly</code> characteristic, allowing RAP BO consumers to provide values for the key fields. This <em>optional external numbering</em> use case means the framework supplies values only if the consumer provides initial values.</li>
<li>For custom numbering, the <code>early numbering</code> specification is required, which requires implementing the numbering in a RAP handler method.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Standard operations (CUD operations)</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>create; 
update; 
delete; 

//Multiple additions are available (but the operation itself can 
//only be specified once). Combinations are possible. Examples:
internal create;
create ( features : global, precheck, authorization : none ); 
create { default function GetDefaultsForCreate; }                  
update ( features : instance ); 
delete ( authorization : update );</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Specifying CUD operations is optional. If you do not specify <code>update</code>, you cannot perform update operations for RAP BO instances.</li>
<li>In a managed RAP BO, these operations (along with read operations) are automatically handled, requiring no custom implementation. This differs from unmanaged RAP BOs, where you must implement the entire logic in dedicated RAP handler methods.</li>
<li>Various additions can be specified (unless stated otherwise, these additions apply to all CUD operations):</li>
<li><code>internal</code>: Defines operations as internal.</li>
<li><code>features : instance</code>: Enables dynamic feature control for update or delete (not create).</li>
<li><code>features : global</code>: Enables global feature control.</li>
<li><code>precheck</code>: Enables precheck.</li>
<li><code>authorization : none</code>: Excludes operations from authorization checks.</li>
<li><code>authorization : update</code>: Delegates authorization control to the update operation&#x27;s authorization check implementation. This applies only to delete operations.</li>
<li><code>{default function ...}</code>: Defines a <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_bo_defaulting_glosry.htm">RAP default values function</a> for the create operation only, which sets default field values on the user interface.</li>
</ul>
<div class="note">[!NOTE] - The read operation is always implicitly enabled for each entity listed in a BDEF and cannot be explicitly declared (there is no `read` syntax). - Delete operations on RAP BO instances of the parent entity in managed RAP BOs also delete associated child entity instances that are in a composition relationship.</div>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Actions as non-standard operations</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>action act1;
internal action act2;
static action act3;
repeatable action act4;

action ( features : global ) act5;
action ( features : instance ) act6;
action ( precheck ) act7;
action ( authorization : global ) act8;
action ( authorization : instance ) act9;
action ( authorization : update ) act10;
action ( authorization : none ) act11;
action ( lock : none ) act12;
action act13 parameter SOME_ENTITY;
action act14 parameter SOME_ENTITY result [1] $self;
action act15 deep table parameter SOME_ENTITY;
action act16 deep result selective [1] SOME_ENTITY;
action act17 external &#x27;SomeName&#x27;;
action act18 {default function SomeFuncName;}

factory action act19 [1];
default factory action act20 [1];
save(...) action act21;</code></pre>
<div class="note">[!NOTE] - Different kinds and flavors of actions can be specified, and numerous syntax additions are available. The code snippet shows a selection only. - Combinations are possible. Make sure that you get the complete picture in the ABAP Keyword Documentation as not all options are listed in the ABAP cheat sheet.</div>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Actions are self-implemented in dedicated handler methods and represent non-standard operations for modifying RAP BO instance data.</li>
<li>Notes on syntax options:</li>
<li>When neither the <code>factory</code> nor <code>save</code> specifications are used (as in <code>act1</code>), the action is categorized as non-factory, meaning its primary purpose is to modify rather than create instances.</li>
<li><code>static</code>: Defines a static action not bound to any RAP BO instance but related to the entire RAP BO entity.</li>
<li><code>repeatable</code>: Defines a repeatable, non-factory action that can execute multiple times on the same RAP BO instance within one request.</li>
<li><code>internal</code>: Restricts access to the action to within the business object implementation.</li>
<li><code>external</code>: Allows specification of an alias name for external use.</li>
<li><code>lock : none</code>: Prevents locking on the RAP BO instance.</li>
<li><code>features : instance</code>: Enables dynamic feature control for actions, allowing the action to be available only if certain preconditions regarding the instance state are met.</li>
<li><code>features : global</code>: Enables global feature control for actions, allowing availability only if specific global, RAP BO-external preconditions are met.</li>
<li><code>precheck</code>: Enables a precheck for actions to prevent unwanted changes from reaching the transactional buffer.</li>
<li><code>authorization : none</code>: Excludes authorization checks.</li>
<li><code>authorization : update</code>: Delegates authorization control to the check implemented for the update operation.</li>
<li><code>authorization : global</code>: Replaces the specified authorization control in the authorization  master entity with global authorization checks.</li>
<li><code>authorization : instance</code>: Replaces the specified authorization control in the authorization  master entity with instance authorization checks.</li>
<li><code>... parameter ...</code>:</li>
<li>Defines an input parameter for actions.</li>
<li>The input parameter can be flat or deep (using the specifications <code>deep</code> and <code>deep table</code>).</li>
<li>For flat parameters, <code>SOME_ENTITY</code> represents a CDS abstract entity or a DDIC type.</li>
<li>For deep parameters (structures or tables), <code>SOME_ENTITY</code> represents an <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_abstract_bdef_glosry.htm">abstract BDEF</a> defined with <code>with hierarchy</code>.</li>
<li><code>... result ...</code>:</li>
<li>Defines an output parameter for actions.</li>
<li>Used to store the result. When specified, the handler method in the ABP includes the <code>RESULT</code> addition in the signature.</li>
<li>There are several syntax options after <code>result</code>, including:</li>
<li><code>selective</code>: Returns only parts of the result, such as just the keys. When used, the corresponding handler method includes the input parameter <code>REQUEST ...</code> to mark the desired fields.</li>
<li><code>[...]</code>: Defines the cardinality of the output parameter. Examples: <code>[0..1]</code>, <code>[1]</code>, <code>[0..<em>]</code>, <code>[1..</em>]</code>.</li>
<li><code>$self</code>: Indicates that the result type matches the entity type.</li>
<li><code>entity some_entity</code>: Specifies that the result type corresponds to another CDS view entity.</li>
<li><code>default function</code>: Defines a <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_bo_defaulting_glosry.htm">RAP default values function</a> for the action, which defaults input parameter values. As a prerequisite, the action must specify an input parameter.</li>
<li><code>factory</code>: Defines a factory action</li>
<li>Used to create RAP BO instances (including child entities).</li>
<li>Can be either instance-bound (for copying specific field values from an instance) or static (for creating instances with predefined default values).</li>
<li>Output parameters are not permitted here.</li>
<li>Cardinality specifications: <code>[1]</code> (creates exactly one entity instance), <code>[0..1]</code> (creates none or exactly one entity instance), <code>[0..<em>]</code> (creates none or any number of instances), <code>[1..</em>]</code> (creates any number of instances, but at least one).</li>
<li>Besides <code>internal</code> and <code>static</code>, factory actions can be specified with <code>static default factory ...</code>. This addition is evaluated by consuming frameworks, such as OData, which use the default factory action as the standard action in certain scenarios.</li>
<li><code>save( ... )</code>:</li>
<li>Defines save actions callable only during specific RAP saver methods.</li>
<li>The parentheses can include <code>finalize</code> and/or <code>adjustnumbers</code>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Functions as non-standard operations</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>function func1 result [0..*] $self;

static function func2 result [1] SOME_ENTITY;

function func3 parameter SOME_ENTITY result [1] $self;</code></pre>
<div class="note">[!NOTE] - Different kinds and flavors of functions can be specified, and numerous syntax additions are available. The code snippet shows a selection only. - Combinations are possible. Make sure that you get the complete picture in the ABAP Keyword Documentation as not all options are listed.</div>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Functions are self-implemented in dedicated handler methods, designed for non-standard operations that return information, such as calculations or read operations, without locking or modifying data.</li>
<li>You can also define static, internal, repeatable, and default functions, specify external names and input parameters.</li>
<li>It is possible to define <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_key_function_glosry.htm">RAP key functions</a>, which accept values of an alternative key as input and return matching entity instances. These functions are commonly used in <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abencds_cross_bo_assoc_glosry.htm">cross-BO association</a> contexts. Find more information <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_KEYFUNCTION.html">here</a>.</li>
<li>Specifying an output parameter is mandatory. Refer to the actions section for details on specification options, including cardinality.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Operations for associations</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>association _Assoc;

association _Assoc { create; }

association _Assoc
  {
    create;
    link action some_link_action;
    unlink action some_unlink_action;
    inverse function some_inv_func;
  }</code></pre>
<div class="note">[!NOTE] Numerous syntax options are available in that context. Find more information [here](https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_ASSOCIATION.html).</div>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>The syntax allows operations along association paths and impacts association targets. You can enable both standard operations (such as create-by-association and read-by-association) and non-standard operations (such as link and unlink actions or inverse functions) for associations.</li>
<li>As a prerequisite, you must define behavior for the association target using <code>define behavior ...</code>.</li>
<li>Read-by-association operations are automatically enabled when you specify the association, for example, using <code>association _Assoc;</code>.</li>
<li>The statement <code>association _Assoc { create; }</code> enables create-by-association as well as read-by-association operations. Note that <code>create</code> can be enhanced with additional specifications, such as precheck, feature control, authorization, and more. Find more information <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_ASSOC_STAND_OPS.html">here</a>.</li>
<li>The supported <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_ASSOC_NONSTAND_OPS.html">non-standard operations for associations</a> include:</li>
<li>Link action: Associates RAP BO instances with other instances using foreign key settings.</li>
<li>Unlink action: Disconnects two associated RAP BO instances by removing the value of the foreign key field.</li>
<li>Inverse Function: Receives the values of the foreign key fields from the association target instances as input and provides the corresponding association source instances as output. Explicit output parameters are optional.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Draft actions</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>draft action Activate optimized;
draft action Discard;
draft action Edit;
draft action Resume;

draft determine action Prepare;

draft determine action Prepare
  { determination ...;
    validation ...; }
</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Draft actions, available only for draft-enabled RAP BOs, manage the state of draft and active instances during their lifecycle.</li>
<li>The implementation is implicitly provided, requiring no additional implementation in the ABP. However, the draft actions <code>activate</code>, <code>discard</code>, <code>edit</code>, and <code>resume</code> support the optional addition <code>with additional implementation</code>. When specified, you can add a custom implementation for the respective <code>FOR MODIFY ... ACTION</code> method in the ABP.</li>
<li>Notes on the draft actions:</li>
<li><code>Edit</code>: Copies an active instance to the draft database table.</li>
<li><code>Activate</code>: Transfers the content of the draft database table to the persistent database table and clears the draft table. This method call implicitly executes the draft determination action <code>Prepare</code>. For better performance, it is advisable to use the optional addition <code>optimized</code>, which reduces the number of determinations and validations executed.</li>
<li><code>Discard</code>: Deletes draft instances from the draft database table.</li>
<li><code>Resume</code>: Is automatically executed whenever a draft instance, whose exclusive lock has expired, is modified. It re-establishes the lock for the corresponding entity instance in the active database table.</li>
<li><code>draft determine action Prepare</code>: Executes the determinations and validations (only those specified with <code>on save</code>) assigned to it in the behavior definition. <code>draft determine action Prepare;</code> denotes that it is possible not to define any determinations or validations.</li>
<li>Find more information <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_DRAFT_ACTION.html">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Validations</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>validation val1 on save { create; update; }
validation val2 on save { delete; }
validation val3 on save { field some_field; }
validation val4 on save { delete; field some_field; }</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Validations check the consistency of RAP BO instances based on trigger conditions. A called validation can reject inconsistent instance data from being saved and return messages (via failed and reported entries) to the RAP BO consumer.</li>
<li>They are automatically called during the save sequence (indicated by the addition of <code>on save</code>) when trigger conditions are met.</li>
<li>Trigger conditions may include modification operations (create, update - only in conjunction with create -, delete) or specific field modifications (that is, when particular field values change during create and update operations). If multiple trigger conditions are specified, the evaluation occurs if at least one condition is met.</li>
<li>Validations are implemented in the <code>FOR VALIDATE</code> RAP handler method.</li>
<li>When inconsistent RAP BO instance data is rejected, the entire transactional buffer is rejected, including instances without inconsistencies. This &quot;all or nothing&quot; approach ensures that a final commit to the database occurs only if all data is consistent. Therefore, inconsistencies must be resolved, or the transactional buffer must be rolled back.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Determinations</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>determination det1 on save { create; }
determination det2 on save { delete; }
determination det3 on save { field some_field; }

determination det4 on modify { create; }
determination det5 on modify { field some_field; }</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Determinations are used to modify RAP BO instances based on trigger conditions. A determination can be used for calculations and data modifications.</li>
<li>They are automatically triggered when conditions are met.</li>
<li>Trigger conditions include modify operations (create, update - only together with create in case of <code>on save</code> -, and delete) or specific field modifications (that is, when specific field values change during create and update operations). If multiple trigger conditions are specified, the determination is executed if at least one condition is satisfied.</li>
<li>There are two types of determinations based on the program flow stage:</li>
<li><code>on modify</code>: Is executed immediately after data changes occur in the transactional buffer, making the result available during the transaction.</li>
<li><code>on save</code>: Is executed at the end of a transaction during the save sequence when changes from the transactional buffer are persisted to the database.</li>
<li>Determinations are implemented in <code>FOR DETERMINE</code> RAP handler methods.</li>
<li>Note that the execution order of multiple specified determinations is arbitrary.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Determine actions</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code> determine action det_act
  {
    determination det1;
    determination ( always ) det2;
    validation val;
  }</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>Determine actions execute assigned determinations and validations on request.</li>
<li>Only <code>on save</code> determinations and validations can be assigned. <code>on modify</code> determinations cannot be assigned.</li>
<li>By default, assigned determinations and validations are only executed if trigger conditions are met. You can use the <code>always</code> addition to ensure they are executed regardless of trigger conditions.</li>
<li>Execution order: First determinations, then validations. The order among determinations and validations is independent of the specification order.</li>
<li>After <code>determine action</code>, you can specify authorization-specific additions (such as <code>authorization : none</code>).</li>
<li>Note that the draft determine action <code>Prepare</code> corresponds to these determine actions.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>RAP business events</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>event evt1;
event evt2 parameter SOME_ENTITY;
event evt3 deep parameter SOME_ENTITY;

managed event evt4 on evt1 parameter SOME_ENTITY;

event evt5 for side effects;</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>A RAP business event typically represents information about the outcome of a CUD operation.</li>
<li>RAP business events enable asynchronous communication between an event provider and an event consumer. An event consumer that subscribes to events can receive and process them. The information passed, known as the event payload, always includes the instance key and, if necessary, additional details.</li>
<li>To pass information, you can define an optional input parameter <code>parameter ...</code>. <code>SOME_ENTITY</code> refers to a CDS abstract entity. The syntax <code>deep parameter ...</code> is also available, requiring <code>SOME_ENTITY</code> to be an abstract BDEF specified with <code>with hierarchy</code>.</li>
<li>RAP business events are typically triggered in ABPs during the RAP late save, using the ABAP EML statement <code>RAISE ENTITY EVENT</code>. For managed RAP BOs, it is advisable to define the BO with <code>with additional save</code> and raise business events in the <code>save_modified</code> method.</li>
<li>Special types of RAP business events:</li>
<li>RAP derived events (<code>managed event</code>): These events are defined in relation to an existing RAP business event, allowing for a redefined payload. They are automatically raised when the referenced event is triggered.</li>
<li>RAP business events for side effects (<code>... for side effects</code>): These events are used solely for an <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/index.htm?file=abenrap_event_sideef_glosry.htm">RAP event-driven side effect</a>, meaning a RAP side effect is initiated by this business event.</li>
<li>Note that once a RAP business event is created and raised, you must define an event binding to map the event to an event type.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>RAP side effects</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>side effects {

    // Side effect with single source property
    field a affects field b;

    $self affects field y;

    // Side effect with multiple source properties and trigger action
    determine action someDetermineAction
    // trigger field group
      executed on field c,
                  field d,
                  field _Assoc.e
      affects field f;

    // Side effect that triggers the reload of feature control
    field g affects permissions(field h);

    // Side effect on an action with operation control and messages
    action act1 affects field *,
                       permissions(action act2),
                       messages;

    // Side effect for refreshing data of an entity
    action act3 affects field i, entity _Assoc;

    event evt affects field j;

  }</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li>RAP side effects define interdependencies among RAP BO properties that trigger a reload of affected properties in the user interface.</li>
<li>No custom implementations are required.</li>
<li>Multiple side effects can be summarized within curly brackets, separated by semicolons (<code>;</code>).</li>
<li>Notes on selected trigger properties:</li>
<li><code>field ... affects</code>: When the defined field changes on the user interface, the side effect is triggered, and the specified targets are reloaded.</li>
<li><code>$self affects</code>: When the current RAP BO entity undergoes a CUD operation, the side effect is triggered, and the specified targets are reloaded. Note that the targets may include fields from associated entities but cannot include fields from the current entity.</li>
<li><code>action ... affects</code>: When the action is executed on the user interface, the side effect is triggered, and the specified targets are reloaded.</li>
<li><code>determine action ...</code>: Defines a side effect that triggers a determine action. When any defined source following <code>executed on</code> changes, the determine action is executed, and the specified targets are reloaded.</li>
<li><code>event</code>: Defines a business event for side effects. When the defined event occurs, a side effect is triggered, and the specified targets are reloaded.</li>
<li>Regarding the targets (<code>affects ...</code>):</li>
<li><code>field</code>: The specified field is reloaded when a side effect is triggered. One or more fields can be indicated. <code>field *</code> means all fields of the same instance are reloaded. Fields from other entities can be accessed via the association path (<code>_Assoc.e</code>).</li>
<li><code>entity</code>: Triggers a determine action when anything in the specified entity changes.</li>
<li><code>permissions</code>: Reloads feature and authorization control. Syntax options include fields (<code>permissions(field a)</code>), actions (<code>permissions(action act)</code>), standard operations (<code>permissions(create)</code>), and all previously mentioned for associated entities (e.g., <code>permissions(_Assoc.e)</code> or <code>permissions(create _Assoc)</code>).</li>
<li><code>$self</code>: Reloads the own entity.</li>
<li><code>entity</code>: Reloads the specified entity. Grouping options are available, such as <code>... entity (_Assoc1, _Assoc2) ...</code> and <code>... entity _Assoc1.(_ItemAssoc1, _ItemAssoc2) ...</code>.</li>
<li><code>message</code>: Reloads all reported messages.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;tr&gt; &lt;td&gt;</p>
<p>Type Mapping</p>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<pre><code>mapping for demo_dbtab_root
{
  KeyFieldRoot = key_field;
  DataFieldRoot = data_field;
  CharFieldRoot = char_field;
  DecFieldRoot = dec_field;
}</code></pre>
<p>&lt;/td&gt;</p>
<p>&lt;td&gt;</p>
<ul>
<li><code>mapping for</code> maps data types defined in CDS for a RAP business object to non-matching types. For example, it is used in behavior definitions to connect database field names to CDS element names.</li>
<li>If the field names in the DDIC structure and the current data model are identical, no mapping is needed. Otherwise, it is mandatory and will trigger a syntax check warning. In particular, for a managed RAP BO, the field names in the RAP persistent table must align with the corresponding RAP BO entity names. If they do not match, a type mapping is necessary to avoid a syntax check warning.</li>
<li>Syntax variants are available including <code>control</code> and <code>corresponding</code>. Find more information <a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL_TYPE_MAPPING.html">here</a>.</li>
</ul>
<p>&lt;/td&gt; &lt;/tr&gt;</p>
<p>&lt;/table&gt;</p>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
<h2>More Information</h2>
<ul>
<li><a href="https://help.sap.com/docs/abap-cloud/abap-rap/abap-restful-application-programming-model">Development guide for the ABAP RESTful Application Programming Model</a></li>
<li>ABAP Keyword Documentation:</li>
<li><a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENBDL.html">RAP BDL</a></li>
<li><a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENRAP_FEATURE_TABLE.html">Feature Tables</a></li>
<li><a href="https://help.sap.com/doc/abapdocu_cp_index_htm/CLOUD/en-US/ABENCDS_ANNOTATIONS.html">CDS annotations</a></li>
<li><a href="https://help.sap.com/docs/abap-cloud/abap-data-models/abap-data-models">ABAP Data Models guide</a></li>
</ul>
<p>&lt;p align=&quot;right&quot;&gt;&lt;a href=&quot;#top&quot;&gt;⬆️ back to top&lt;/a&gt;&lt;/p&gt;</p>
</body>
</html>